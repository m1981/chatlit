## 1. Project Overview
**Type:** Desktop-First Single Page Application (SPA).
**Goal:** A "Power User" LLM interface for managing complex conversations across multiple providers (OpenAI, Anthropic, DeepInfra).
**Core Value:** High-density utility, precise model control, and advanced context management via a "Highlights" bookmarking system.

## 3. Layout Structure (Desktop Only)
The application utilizes a fixed **3-Column Layout** designed for high-resolution desktop screens. No mobile responsiveness is required.

### Column A: Left Sidebar (Navigation & Assets) - Fixed Width (e.g., 260px)
1.  **Header:** "New Chat" button.
2.  **History List (Scrollable):**
    *   Global list of past chats.
    *   Titles auto-generated by AI.
    *   Sorted chronologically (Newest first).
3.  **Asset Browser (Bottom Section):**
    *   **Scope:** Displays multimedia/files for the **active chat only**.
    *   **Content:** List of generated images or uploaded files.
    *   **Interaction:** Clicking an item scrolls the Main Chat View to the specific message bubble containing that asset.
4.  **Footer:** Global Settings trigger (API Keys, System Defaults).

### Column B: Main Chat Area (Center Stage) - Flexible Width
1.  **Header:**
    *   **Model Selector:** Dropdown (e.g., GPT-4o, Claude 3.5 Sonnet).
    *   **Session Cost:** Real-time counter (e.g., "$0.145") calculated via `(InputTokens * Price) + (OutputTokens * Price)`.
2.  **Message Stream:**
    *   Standard user/AI bubble flow.
    *   **Markdown Rendering:** Full support for code blocks, tables, and math.
3.  **Input Area:**
    *   Textarea (Auto-growing).
    *   Attachment support.
4.  **Context Menu Interaction:**
    *   **Trigger:** User selects text within a message bubble.
    *   **Menu Options:** `Copy Text`, `Copy Markdown`, `Highlight`.
    *   **Action:** Clicking `Highlight` creates a reference in the Right Sidebar.

### Column C: Right Sidebar (Control & Context) - Fixed Width (e.g., 320px)
Split 50/50 vertically.

#### Top Half: Model Settings (Per-Chat State)
Controls apply to the *next* message generation in the current active chat.
1.  **Temperature:** Slider (Range: 0.0 to 1.0 or 2.0 depending on model).
2.  **Thinking Level (Conditional):**
    *   *Visibility:* Only appears if the selected model supports reasoning (e.g., `o1`, `Claude 3.7`, `Gemini 2.0 Flash Thinking`).
    *   *UI:* Segmented Control / Toggle: **[ Low ] [ High ]**.
    *   *Logic:* Maps to internal token budgets defined in config (e.g., Low=1k, High=8k).

#### Bottom Half: Highlights Manager (The "Bookmark" System)
A persistent list of text references saved by the user.
1.  **List Items:** Cards showing a truncated preview of the highlighted text.
2.  **Interaction - Navigation:** Clicking a card scrolls the Main Chat Area to the exact message and visually highlights the text span (e.g., yellow fade).
3.  **Interaction - Management:** Items can be deleted individually via a "Trash" icon.

## 4. Data & Logic Requirements

### 4.1. Cost Calculation
*   Must track token usage per message.
*   Must maintain a pricing table for supported models.
*   Display is "Session Total" (Sum of all messages in current chat).

### 4.2. Model Configuration
*   Models are defined in a config file/object with properties:
    *   `id`: string
    *   `name`: string
    *   `provider`: 'openai' | 'anthropic' | 'deepinfra'
    *   `hasReasoning`: boolean (triggers Thinking UI)
    *   `pricing`: { input: number, output: number }

### 4.3. Persistence
*   Chat history and Highlights must persist (LocalStorage or IndexedDB recommended for client-side app).

## 5. Design System Notes
*   **Theme:** Dark Mode default (Developer tool aesthetic).
*   **Density:** High. Use compact spacing.
*   **Feedback:** Visual cues for "Copied to clipboard" and "Added to Highlights".